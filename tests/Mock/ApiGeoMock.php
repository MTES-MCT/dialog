<?php

declare(strict_types=1);

namespace App\Tests\Mock;

use Symfony\Component\HttpClient\MockHttpClient;
use Symfony\Component\HttpClient\Response\MockResponse;

final class ApiGeoMock extends MockHttpClient
{
    private string $baseUri = 'https://testserver';

    public function __construct()
    {
        $callback = \Closure::fromCallable([$this, 'handleRequests']);
        parent::__construct($callback, $this->baseUri);
    }

    private function handleRequests(string $method, string $url, array $options): MockResponse
    {
        $payload = null;

        // Savenay
        if (str_contains($url, 'communes/44195')) {
            $payload = '{"contour":{"type":"Polygon","coordinates":[[[-1.923095,47.3344],[-1.923146,47.334442],[-1.923561,47.334605],[-1.924737,47.335119],[-1.924172,47.33577],[-1.924055,47.335924],[-1.924052,47.336065],[-1.924367,47.336316],[-1.924585,47.336545],[-1.924804,47.336833],[-1.924937,47.337066],[-1.92496,47.337242],[-1.924902,47.337362],[-1.924751,47.33751],[-1.924353,47.338013],[-1.924038,47.338375],[-1.923777,47.338596],[-1.923795,47.338784],[-1.924152,47.339197],[-1.92467,47.339931],[-1.925789,47.341704],[-1.92634,47.342584],[-1.926612,47.343058],[-1.926818,47.343386],[-1.927327,47.344271],[-1.927629,47.344758],[-1.927759,47.344894],[-1.929298,47.345677],[-1.929415,47.345719],[-1.929757,47.3457],[-1.93079,47.345233],[-1.931795,47.344653],[-1.933702,47.343674],[-1.934366,47.343726],[-1.934655,47.343796],[-1.935175,47.3447],[-1.93577,47.344678],[-1.936865,47.344277],[-1.937291,47.343812],[-1.937403,47.343272],[-1.937637,47.343209],[-1.93815,47.342972],[-1.938595,47.342832],[-1.938814,47.342829],[-1.939986,47.342922],[-1.940635,47.343011],[-1.942387,47.343713],[-1.943245,47.343681],[-1.943468,47.34256],[-1.943641,47.342518],[-1.943808,47.342115],[-1.943812,47.341897],[-1.943629,47.340675],[-1.943681,47.340538],[-1.943479,47.340433],[-1.943355,47.340301],[-1.943088,47.339658],[-1.942885,47.339405],[-1.942809,47.339034],[-1.94286,47.338896],[-1.943028,47.338793],[-1.943776,47.338601],[-1.944072,47.338485],[-1.944679,47.338337],[-1.944848,47.338329],[-1.945794,47.33844],[-1.946013,47.338528],[-1.946128,47.338688],[-1.946144,47.338788],[-1.946092,47.339008],[-1.946094,47.339204],[-1.946242,47.339532],[-1.94649,47.339931],[-1.94683,47.33993],[-1.947086,47.340355],[-1.947741,47.340386],[-1.947998,47.340557],[-1.948351,47.340844],[-1.948303,47.341187],[-1.949247,47.342226],[-1.949291,47.342324],[-1.950415,47.343408],[-1.951199,47.344119],[-1.9513,47.344197],[-1.951636,47.344358],[-1.952126,47.344491],[-1.952602,47.344644],[-1.953046,47.344733],[-1.95353,47.344758],[-1.953985,47.344811],[-1.954186,47.344811],[-1.955232,47.345303],[-1.955497,47.345363],[-1.955905,47.343482],[-1.956432,47.343521],[-1.957158,47.343684],[-1.957937,47.343926],[-1.958179,47.343974],[-1.958725,47.343993],[-1.958963,47.344025],[-1.959182,47.344091],[-1.959591,47.344299],[-1.959952,47.344521],[-1.960261,47.344793],[-1.960476,47.344901],[-1.960912,47.345052],[-1.961463,47.345212],[-1.961537,47.345325],[-1.9614,47.345683],[-1.961318,47.346087],[-1.96131,47.346392],[-1.961346,47.346503],[-1.961606,47.346791],[-1.962025,47.347147],[-1.962367,47.347373],[-1.962892,47.347794],[-1.963158,47.348051],[-1.963066,47.348179],[-1.962652,47.348545],[-1.962291,47.348736],[-1.96255,47.348844],[-1.962853,47.348929],[-1.963055,47.348947],[-1.96336,47.349048],[-1.963593,47.349224],[-1.963782,47.349304],[-1.963907,47.349407],[-1.963964,47.349463],[-1.963793,47.349584],[-1.963802,47.349704],[-1.963967,47.350204],[-1.963925,47.350331],[-1.964048,47.350503],[-1.964028,47.350774],[-1.964189,47.351023],[-1.964316,47.351328],[-1.964269,47.351497],[-1.963847,47.351924],[-1.963407,47.352237],[-1.962393,47.353056],[-1.962,47.353354],[-1.96167,47.353498],[-1.96111,47.353889],[-1.960979,47.354052],[-1.960705,47.354465],[-1.96051,47.354489],[-1.960006,47.354423],[-1.959917,47.354451],[-1.959719,47.35467],[-1.959659,47.355202],[-1.959518,47.355345],[-1.959147,47.355587],[-1.959065,47.35569],[-1.958969,47.355922],[-1.959192,47.356557],[-1.958891,47.356929],[-1.958644,47.357163],[-1.958413,47.358336],[-1.958207,47.358294],[-1.957506,47.358066],[-1.957143,47.358042],[-1.956861,47.358175],[-1.956146,47.358681],[-1.956014,47.358853],[-1.955448,47.359474],[-1.95518,47.359435],[-1.955101,47.359773],[-1.955424,47.359766],[-1.955502,47.359822],[-1.955485,47.359981],[-1.955978,47.360069],[-1.956032,47.360007],[-1.956311,47.360064],[-1.95638,47.360126],[-1.956548,47.360066],[-1.956607,47.360256],[-1.956324,47.360695],[-1.956645,47.360905],[-1.956836,47.361154],[-1.95605,47.36198],[-1.957014,47.36251],[-1.957404,47.362759],[-1.957753,47.36286],[-1.958243,47.363129],[-1.958804,47.36334],[-1.959415,47.363596],[-1.95931,47.36381],[-1.959756,47.363932],[-1.960053,47.36427],[-1.960082,47.364509],[-1.960253,47.364559],[-1.960442,47.36489],[-1.960263,47.365344],[-1.960266,47.36548],[-1.96076,47.366001],[-1.960771,47.366345],[-1.960701,47.366479],[-1.960321,47.36677],[-1.960289,47.367041],[-1.960219,47.367189],[-1.960049,47.367351],[-1.959598,47.367712],[-1.959269,47.367903],[-1.958647,47.36844],[-1.958709,47.368836],[-1.958486,47.369195],[-1.956728,47.37003],[-1.956815,47.370251],[-1.956859,47.370545],[-1.956813,47.371404],[-1.956324,47.373645],[-1.955827,47.374425],[-1.956196,47.374816],[-1.956477,47.375004],[-1.956502,47.37513],[-1.956855,47.376108],[-1.95705,47.376697],[-1.957402,47.37764],[-1.957491,47.377829],[-1.957286,47.378371],[-1.956267,47.378103],[-1.955337,47.377896],[-1.953929,47.377627],[-1.953442,47.377543],[-1.952571,47.377421],[-1.952402,47.377535],[-1.951509,47.377415],[-1.949151,47.377113],[-1.948968,47.377272],[-1.947897,47.37713],[-1.947754,47.377566],[-1.941886,47.377153],[-1.941317,47.376951],[-1.94118,47.377102],[-1.940966,47.377055],[-1.940895,47.377151],[-1.937137,47.376653],[-1.934006,47.375643],[-1.932377,47.375162],[-1.92775,47.374523],[-1.925809,47.373885],[-1.92432,47.374734],[-1.923215,47.375252],[-1.922793,47.375527],[-1.920839,47.377056],[-1.919978,47.377736],[-1.9196,47.378067],[-1.918934,47.378608],[-1.918541,47.378948],[-1.917604,47.379734],[-1.917345,47.37998],[-1.916826,47.380551],[-1.916435,47.380708],[-1.916209,47.380617],[-1.915956,47.380444],[-1.915714,47.380368],[-1.915448,47.380235],[-1.915331,47.380136],[-1.914804,47.379861],[-1.914455,47.379767],[-1.914098,47.379747],[-1.91343,47.379648],[-1.913116,47.379642],[-1.912693,47.37952],[-1.91233,47.379475],[-1.911973,47.379374],[-1.911402,47.379295],[-1.910729,47.379049],[-1.910398,47.378896],[-1.910235,47.378847],[-1.909765,47.378809],[-1.909035,47.378644],[-1.908825,47.378402],[-1.908585,47.378281],[-1.90847,47.378135],[-1.908135,47.378001],[-1.907762,47.377903],[-1.906869,47.37779],[-1.906743,47.377787],[-1.906084,47.377678],[-1.905697,47.377645],[-1.904865,47.377282],[-1.90419,47.377007],[-1.903259,47.37665],[-1.903132,47.376632],[-1.902956,47.376694],[-1.902242,47.376796],[-1.902071,47.376888],[-1.901965,47.377042],[-1.901436,47.377964],[-1.901114,47.378191],[-1.90083,47.378303],[-1.90036,47.378593],[-1.899354,47.378822],[-1.899145,47.378917],[-1.89886,47.378988],[-1.898451,47.379169],[-1.898028,47.379495],[-1.89779,47.37956],[-1.897404,47.379754],[-1.896897,47.379771],[-1.896604,47.37986],[-1.896196,47.379918],[-1.895806,47.380005],[-1.895474,47.380026],[-1.895053,47.380158],[-1.89458,47.380205],[-1.894236,47.380219],[-1.893887,47.380301],[-1.892975,47.380188],[-1.892362,47.380123],[-1.891952,47.380131],[-1.891206,47.380258],[-1.890707,47.380244],[-1.89047,47.380209],[-1.889899,47.380067],[-1.889563,47.379957],[-1.889322,47.379905],[-1.888404,47.379777],[-1.886899,47.379535],[-1.886572,47.379497],[-1.886216,47.379485],[-1.884692,47.379363],[-1.884382,47.379306],[-1.884002,47.379117],[-1.88385,47.378984],[-1.883611,47.378835],[-1.883157,47.378644],[-1.882788,47.378605],[-1.882303,47.378515],[-1.882177,47.378429],[-1.881458,47.377821],[-1.881123,47.377416],[-1.880706,47.376619],[-1.880625,47.376373],[-1.880517,47.375594],[-1.880548,47.374507],[-1.880305,47.373245],[-1.880128,47.373167],[-1.880497,47.372816],[-1.880745,47.372705],[-1.881226,47.372571],[-1.881143,47.372088],[-1.881639,47.371665],[-1.881945,47.371338],[-1.882479,47.370839],[-1.882291,47.37069],[-1.88255,47.369305],[-1.882547,47.367579],[-1.883481,47.366833],[-1.883871,47.366268],[-1.882923,47.365574],[-1.88298,47.365363],[-1.881996,47.365116],[-1.879769,47.364792],[-1.879217,47.364689],[-1.878607,47.364482],[-1.877258,47.363972],[-1.876592,47.363686],[-1.876383,47.363576],[-1.876904,47.36311],[-1.877448,47.362128],[-1.87809,47.361134],[-1.878628,47.359855],[-1.878567,47.359522],[-1.878976,47.358798],[-1.879522,47.357895],[-1.879765,47.357451],[-1.880106,47.356864],[-1.880031,47.356853],[-1.880163,47.356632],[-1.88074,47.355914],[-1.881299,47.3552],[-1.881856,47.354535],[-1.882137,47.354237],[-1.882928,47.353342],[-1.883283,47.352955],[-1.883007,47.352053],[-1.882835,47.351549],[-1.882775,47.351003],[-1.883672,47.350421],[-1.885016,47.348975],[-1.88586,47.348333],[-1.886296,47.348152],[-1.886695,47.347827],[-1.886886,47.347493],[-1.887509,47.346815],[-1.887686,47.346494],[-1.887978,47.346253],[-1.888407,47.345778],[-1.888955,47.345214],[-1.889071,47.345042],[-1.889305,47.344878],[-1.889344,47.344782],[-1.889341,47.344362],[-1.889374,47.344134],[-1.88946,47.343906],[-1.889765,47.34331],[-1.889723,47.343065],[-1.889745,47.342887],[-1.889806,47.342807],[-1.890028,47.342658],[-1.89012,47.342544],[-1.89019,47.342353],[-1.890342,47.342254],[-1.890424,47.342117],[-1.890473,47.341621],[-1.890318,47.341527],[-1.890474,47.3412],[-1.890713,47.340862],[-1.890865,47.340356],[-1.890943,47.340233],[-1.891214,47.339958],[-1.891399,47.339817],[-1.891602,47.339747],[-1.891868,47.339706],[-1.892085,47.339576],[-1.892447,47.339541],[-1.892833,47.339442],[-1.893406,47.339448],[-1.893607,47.339356],[-1.893907,47.339129],[-1.894131,47.339015],[-1.894629,47.338819],[-1.894819,47.338603],[-1.894839,47.338414],[-1.894759,47.338345],[-1.894722,47.338173],[-1.894755,47.337953],[-1.89468,47.337733],[-1.894612,47.33739],[-1.894504,47.337207],[-1.894365,47.337121],[-1.894263,47.336747],[-1.894277,47.336603],[-1.894396,47.336373],[-1.894704,47.336028],[-1.894933,47.336008],[-1.895074,47.335945],[-1.895156,47.335786],[-1.895049,47.335352],[-1.894969,47.335116],[-1.89496,47.33496],[-1.894997,47.33461],[-1.895191,47.334293],[-1.895389,47.333924],[-1.895575,47.333487],[-1.89565,47.333249],[-1.895642,47.3331],[-1.89517,47.332202],[-1.895023,47.331942],[-1.89472,47.330688],[-1.894507,47.330535],[-1.893761,47.330359],[-1.893756,47.330116],[-1.893662,47.329605],[-1.893661,47.329334],[-1.893738,47.329057],[-1.893898,47.328837],[-1.893921,47.328336],[-1.893888,47.327889],[-1.893855,47.3278],[-1.894445,47.327784],[-1.895265,47.32771],[-1.895679,47.327695],[-1.896257,47.327651],[-1.896802,47.327627],[-1.899005,47.327641],[-1.899953,47.327632],[-1.900622,47.327601],[-1.900628,47.327645],[-1.902417,47.327771],[-1.903016,47.327782],[-1.90544,47.327882],[-1.906115,47.32792],[-1.90797,47.328075],[-1.908278,47.328095],[-1.908833,47.328196],[-1.909846,47.328861],[-1.910192,47.329101],[-1.911299,47.329701],[-1.911641,47.329918],[-1.911767,47.329853],[-1.912345,47.329805],[-1.91303,47.329783],[-1.913512,47.329727],[-1.913657,47.329659],[-1.914401,47.329122],[-1.914796,47.329021],[-1.915697,47.329039],[-1.915975,47.329057],[-1.916414,47.329139],[-1.916566,47.329194],[-1.916797,47.329413],[-1.917034,47.329602],[-1.917385,47.330081],[-1.917415,47.330164],[-1.917367,47.330438],[-1.917519,47.330328],[-1.918178,47.330628],[-1.918239,47.330719],[-1.918025,47.330952],[-1.917972,47.331175],[-1.917949,47.331691],[-1.917924,47.33185],[-1.917536,47.331888],[-1.917376,47.331982],[-1.918371,47.332409],[-1.923095,47.3344]]]},"nom":"Savenay","code":"44195"}';
        }

        return new MockResponse(
            $payload,
            ['http_code' => 200],
        );
    }
}
