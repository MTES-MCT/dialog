<?php

declare(strict_types=1);

namespace App\Tests\Integration\Infrastructure\Controller\Map;

use App\Tests\Integration\Infrastructure\Controller\AbstractWebTestCase;

final class MapControllerTest extends AbstractWebTestCase
{
    public function testGet(): void
    {
        $client = static::createClient();
        $crawler = $client->request('GET', '/carte');

        $this->assertResponseStatusCodeSame(200);
        $this->assertSecurityHeaders();
        $this->assertMetaTitle('Carte - DiaLog', $crawler);
        $this->assertSame('{"type":"FeatureCollection","features":[{"type":"Feature","geometry":{"type":"LineString","coordinates":[[1.35644,44.01574],[1.35634,44.01578],[1.35628,44.01581],[1.3562,44.01584],[1.35573,44.01601],[1.35515,44.01624],[1.35505,44.01628],[1.35476,44.0164],[1.35431,44.0166],[1.35426,44.01663]]},"properties":{"location_uuid":"06548f85-d545-7b45-8000-8a23c45850b3","measure_type":"noEntry"}},{"type":"Feature","geometry":{"type":"LineString","coordinates":[[4.81381,49.59185],[4.8141,49.59185],[4.81432,49.59185],[4.81454,49.59186],[4.81474,49.59187],[4.81501,49.5919],[4.81534,49.59194],[4.81583,49.59202],[4.81615,49.59206],[4.8165,49.5921],[4.81667,49.59211],[4.81704,49.59213],[4.81715,49.59214],[4.81745,49.59216],[4.81776,49.59218],[4.81802,49.59219],[4.81819,49.59221],[4.81834,49.59223],[4.81856,49.59229],[4.81887,49.59238],[4.81916,49.59246],[4.81929,49.59248],[4.81945,49.59251],[4.8196,49.59252],[4.81974,49.59253],[4.81989,49.59252],[4.82008,49.59251],[4.82029,49.59249],[4.82054,49.59246],[4.82099,49.59239],[4.82169,49.59229],[4.82233,49.59219],[4.82278,49.59213],[4.82284,49.59212],[4.82369,49.592],[4.82492,49.59182],[4.82634,49.59161],[4.82747,49.59145],[4.82827,49.59133],[4.82901,49.59122],[4.82952,49.59115],[4.82981,49.59109],[4.82997,49.59103],[4.83009,49.59096],[4.83017,49.59088],[4.83024,49.59079],[4.83027,49.59075],[4.83035,49.59062],[4.83049,49.59042],[4.83062,49.59021],[4.83072,49.59008],[4.83082,49.58997],[4.83091,49.58989],[4.83104,49.58978],[4.83118,49.58969],[4.8314,49.58957],[4.83166,49.58944],[4.83203,49.58927],[4.83239,49.5891],[4.83275,49.58893],[4.83314,49.58875],[4.83355,49.58854],[4.83422,49.58823],[4.8346,49.58809],[4.8347,49.58805],[4.83558,49.58773],[4.83644,49.58742],[4.83697,49.58724],[4.83719,49.58717],[4.83738,49.58714],[4.83762,49.5871],[4.83797,49.58707],[4.83816,49.58705],[4.83825,49.58704],[4.83847,49.58701],[4.83869,49.58697],[4.83903,49.58688],[4.83924,49.5868],[4.83945,49.5867],[4.84004,49.5864],[4.84087,49.58589],[4.8413,49.58563],[4.84152,49.58549],[4.84164,49.58543],[4.84181,49.58534],[4.84191,49.58529],[4.84199,49.58525],[4.84245,49.58507],[4.84291,49.5849],[4.84356,49.58469],[4.84429,49.58448],[4.84497,49.58429],[4.84529,49.5842],[4.84624,49.58394],[4.8468,49.58378],[4.84701,49.58372],[4.84769,49.58354],[4.84918,49.58311],[4.84966,49.58299],[4.85005,49.5829],[4.85023,49.5829],[4.8503,49.5829],[4.85036,49.5829],[4.85044,49.5829],[4.85049,49.58291],[4.8506,49.58293],[4.85066,49.58294],[4.85088,49.58299],[4.85112,49.58303],[4.85131,49.58303],[4.85149,49.58301],[4.85167,49.58298],[4.85188,49.58292],[4.85222,49.58281],[4.85253,49.5827],[4.85279,49.58259],[4.85317,49.58243],[4.85349,49.58229],[4.85356,49.58226],[4.85366,49.58221],[4.85387,49.58212],[4.85431,49.5819],[4.85466,49.58175],[4.85522,49.58156],[4.8554,49.5815],[4.85575,49.5814],[4.8561,49.58131],[4.85639,49.58123],[4.85717,49.58103],[4.85719,49.58102],[4.85752,49.58092],[4.85777,49.58082],[4.85801,49.5807],[4.85814,49.58061],[4.8583,49.58049],[4.85848,49.58033],[4.85874,49.58009],[4.85898,49.57989],[4.85925,49.5797],[4.85951,49.57955],[4.85978,49.57942],[4.85986,49.57937],[4.86002,49.5793],[4.86012,49.57925],[4.8602,49.57921],[4.86054,49.57905],[4.86115,49.57873],[4.86203,49.57822],[4.86269,49.57784],[4.86351,49.57735],[4.86367,49.57725],[4.86405,49.57701],[4.86429,49.57684],[4.86475,49.57648],[4.86499,49.57632],[4.86518,49.57618],[4.8654,49.57604],[4.86565,49.57591],[4.86602,49.57572],[4.86722,49.57513],[4.86772,49.57489],[4.86798,49.57477],[4.86833,49.57464],[4.86878,49.57448],[4.86918,49.57433],[4.86932,49.57428],[4.86945,49.57423],[4.86957,49.57418],[4.86966,49.57415],[4.86986,49.57406],[4.87005,49.57396],[4.87024,49.57381],[4.87035,49.57373],[4.87045,49.57355],[4.87051,49.57338],[4.87059,49.57312],[4.87068,49.57287],[4.87082,49.57267],[4.87101,49.57249],[4.87127,49.57231],[4.87149,49.57219],[4.87185,49.57201],[4.87224,49.57182],[4.87255,49.57164],[4.87274,49.5715],[4.87293,49.57132],[4.87307,49.57112],[4.87311,49.57104],[4.87316,49.57091],[4.87327,49.57064],[4.87335,49.57054],[4.8734,49.5705],[4.87341,49.57049],[4.87346,49.57045],[4.87361,49.57035],[4.87386,49.5702],[4.87403,49.57011],[4.87432,49.56995],[4.87456,49.56984],[4.87474,49.56974],[4.87489,49.56965],[4.87501,49.56954],[4.87511,49.56941],[4.87519,49.5693],[4.87526,49.56916],[4.87531,49.56902],[4.87539,49.56878],[4.87546,49.56853],[4.87555,49.56819],[4.87561,49.56797],[4.87567,49.56776],[4.87574,49.56759],[4.87581,49.56741],[4.87591,49.56723],[4.87607,49.56696],[4.87615,49.56683],[4.87622,49.56673],[4.87629,49.56665],[4.87636,49.56659],[4.87645,49.56654],[4.87653,49.56651],[4.87664,49.56649],[4.87675,49.56648],[4.87687,49.56649],[4.87706,49.56654],[4.87766,49.56668],[4.87821,49.56681],[4.87841,49.56686],[4.87846,49.56687],[4.87856,49.56689],[4.87865,49.5669],[4.87878,49.56691],[4.8789,49.56692],[4.87904,49.56691],[4.87921,49.56689],[4.87947,49.56684],[4.87997,49.56672],[4.8802,49.56666],[4.88058,49.56655],[4.88072,49.56651],[4.88084,49.56646],[4.88097,49.5664],[4.88111,49.56631],[4.88124,49.56619],[4.88143,49.56599],[4.88163,49.56575],[4.88179,49.56555],[4.88193,49.56539],[4.88205,49.56528],[4.88216,49.5652],[4.88227,49.56515],[4.8824,49.5651],[4.88251,49.56508],[4.88254,49.56508],[4.88265,49.56507],[4.88289,49.56505],[4.88327,49.56503],[4.88366,49.56501],[4.88407,49.565],[4.88444,49.56499],[4.88477,49.56497],[4.88488,49.56497],[4.885,49.56496],[4.88516,49.56493],[4.88548,49.56486],[4.88577,49.5648],[4.88597,49.56475],[4.88602,49.56474],[4.88627,49.56467],[4.88654,49.56459],[4.88685,49.5645],[4.88713,49.56441],[4.88745,49.56433],[4.88766,49.56465],[4.8878,49.56493],[4.88791,49.56506],[4.88798,49.56511],[4.88808,49.56514],[4.88821,49.56515],[4.88832,49.56514],[4.88848,49.56511],[4.88864,49.56507],[4.88883,49.56505],[4.88898,49.56505],[4.88914,49.56507],[4.88927,49.5651],[4.88936,49.56513],[4.88941,49.56515],[4.8895,49.56522],[4.88955,49.56528],[4.88958,49.56533],[4.88964,49.56547],[4.88966,49.56551],[4.88972,49.56563],[4.88982,49.56577],[4.88994,49.56592],[4.89008,49.56608],[4.89026,49.56628],[4.89041,49.56643],[4.89053,49.5665],[4.89062,49.56654],[4.89072,49.56655],[4.89087,49.56656],[4.89105,49.56654],[4.89145,49.5665],[4.89166,49.56648],[4.89191,49.56647],[4.89219,49.56645],[4.8926,49.56644],[4.89323,49.56642],[4.89377,49.5664],[4.89433,49.56637],[4.89498,49.56635],[4.89523,49.56633],[4.89545,49.56633],[4.8956,49.56634],[4.89569,49.56637],[4.89575,49.56641],[4.89577,49.56645],[4.8958,49.56653],[4.89579,49.56662],[4.89576,49.56676],[4.89572,49.56696],[4.89562,49.56732],[4.89555,49.5676],[4.89547,49.5679],[4.89541,49.56808],[4.89536,49.5682],[4.8953,49.56829],[4.89522,49.56841],[4.89511,49.56855],[4.89495,49.56875],[4.89484,49.56888],[4.89472,49.56906],[4.89462,49.56923],[4.89454,49.56938],[4.89447,49.56955],[4.89441,49.56969],[4.89434,49.56985],[4.89427,49.57008],[4.89422,49.57023],[4.89408,49.5707],[4.89405,49.57081],[4.89398,49.57103],[4.89395,49.57118],[4.89394,49.57135],[4.89396,49.57149],[4.89403,49.57163],[4.89413,49.57175],[4.89426,49.57187],[4.89447,49.57199],[4.89477,49.57214],[4.89514,49.57232],[4.89537,49.57244],[4.89554,49.57254],[4.89569,49.57266],[4.8958,49.57275],[4.8959,49.57284],[4.89603,49.57301],[4.89631,49.57334],[4.89649,49.57356],[4.89657,49.57367],[4.89662,49.57377],[4.89664,49.57386],[4.89665,49.57393],[4.89664,49.57404],[4.89663,49.57411],[4.8965,49.57456],[4.89624,49.57552],[4.89613,49.57593],[4.8961,49.57612],[4.8961,49.57629],[4.89613,49.57662],[4.89614,49.57679],[4.89614,49.57695]]},"properties":{"location_uuid":"065f94ef-ea0a-7ab5-8000-bd5686102151","measure_type":"noEntry"}}]}', $crawler->filter('#locations_as_geojson')->text());
    }

    public function testGetFilters(): void
    {
        $client = static::createClient();
        $crawler = $client->request('GET', '/carte?map_filter_form%5Bcategory%5D=permanents_only&map_filter_form%5B_token%5D=4ef8515d4d5e05fb9f.8Zo-nuv_uVZHlzVSYd0sF6Lgr2Sv0ZOEh2efPahYS6g.vP9H-bO00Wcm51QbUuUdfe6SwwnmptT00QLoBJ87CuTF7kTqparQYCLQRg');

        $this->assertResponseStatusCodeSame(200);
        $this->assertSecurityHeaders();
        $this->assertMetaTitle('Carte - DiaLog', $crawler);
        $this->assertSame('{"type":"FeatureCollection","features":[]}', $crawler->filter('#locations_as_geojson')->text());
    }
}
