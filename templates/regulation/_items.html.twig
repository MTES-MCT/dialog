<div class="fr-table fr-table--layout-fixed">
    <table>
        <thead>
            <tr>
                <th scope="col">{{ 'regulation.city'|trans }}</th>
                <th scope="col">{{ 'regulation.period'|trans }}</th>
                <th scope="col">{{ 'regulation.status'|trans }}</th>
                <th scope="col">{{ 'common.actions'|trans }}</th>
            </tr>
        </thead>
        <tbody>
            {% for regulation in pagination.items %}
                {% set isPresent = regulation.period ? "now"|date('U') >= regulation.period.startPeriod|date('U') : null %}
                <tr>
                    <td>
                        {% if regulation.location %}
                            <b>{{ regulation.location.city }}</b><br/>
                            {{ regulation.location.roadName }}
                        {% endif %}
                    </td>
                    <td>
                        {% if regulation.period %}
                            {% set startPeriod = regulation.period.startPeriod %}
                            {% set endPeriod = regulation.period.endPeriod %}
                            {% if startPeriod and endPeriod %}
                                <b>
                                    {{ 'regulation.period.temporary'|trans({ '%startPeriod%': startPeriod|date('d/m/Y'), '%endPeriod%': endPeriod|date('d/m/Y') })}}
                                </b>
                            {% else %}
                                <b>
                                    {% if isPresent %}
                                        {{ 'regulation.period.permanent.present'|trans({ '%date%': startPeriod|date('d/m/Y')  })}}
                                    {% else %}
                                        {{ 'regulation.period.permanent.future'|trans({ '%date%': startPeriod|date('d/m/Y') })}}
                                    {% endif %}
                                </b>
                                <br/>
                                <em>{{ 'common.permanent'|trans}}</em>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if regulation.status == 'draft' %}
                            <p class="fr-badge fr-badge--info">{{'regulation.status.draft'|trans}}</p>
                        {% elseif regulation.status == 'published' %}
                            {% if isPresent %}
                                <p class="fr-badge fr-badge--success">{{'regulation.present'|trans}}</p>
                            {% else %}
                                <p class="fr-badge fr-badge--new">{{'regulation.future'|trans}}</p>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        <a title="{{ 'common.update'|trans }}" href="{{ path('app_regulations_steps_5', { uuid: regulation.uuid }) }}" class="fr-btn fr-icon-edit-line fr-btn--tertiary-no-outline">
                            {{ 'common.update'|trans }}
                        </a>
                        {% if regulation.status == 'published' %}
                            <a title="{{ 'common.see'|trans }}" href="{{ path('app_regulation_detail', { uuid: regulation.uuid }) }}" class="fr-btn fr-icon-eye-line fr-btn--tertiary-no-outline">
                                {{ 'common.see'|trans }}
                            </a>
                        {% endif %}

                        {% set delete_modal_id = 'delete-modal-' ~ loop.index %}

                        <div
                            data-controller="dialog"
                            data-dialog-submit-value="confirm"
                            hx-delete="{{ path('app_regulation_delete', { uuid: regulation.uuid }) }}"
                            hx-trigger="dialog-submit:confirm"
                            hx-target="closest tr"
                        >
                            <button
                                type="button"
                                class="fr-btn fr-btn--tertiary-no-outline fr-icon-delete-bin-line"
                                data-fr-opened="false"
                                aria-controls="{{ delete_modal_id }}"
                            >
                                {{ 'common.delete'|trans }}
                            </button>

                            <dialog
                                data-dialog-target="dialog"
                                id="{{ delete_modal_id }}"
                                class="fr-modal"
                                role="dialog"
                                aria-labelledby="{{ delete_modal_id }}-title"
                            >
                                <div class="fr-container fr-container--fluid fr-container-md">
                                    <div class="fr-grid-row fr-grid-row--center">
                                        <div class="fr-col-12 fr-col-md-8 fr-col-lg-6">
                                            <form method="dialog" class="fr-modal__body">
                                                <div class="fr-modal__header">
                                                    <button class="fr-link fr-link--close" value="cancel" aria-controls="{{ delete_modal_id }}">
                                                        {{ 'common.close'|trans }}
                                                    </button>
                                                </div>
                                                <div class="fr-modal__content">
                                                    <h1 id="{{ delete_modal_id }}-title" class="fr-modal__title">
                                                        {{ 'regulation.delete_modal.title'|trans }}
                                                    </h1>
                                                </div>
                                                <div class="fr-modal__footer">
                                                    <div class="fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg">
                                                        <button value="confirm" class="fr-btn">
                                                            {{ 'regulation.delete_modal.confirm'|trans }}
                                                        </button>
                                                        <button value="cancel" class="fr-btn fr-btn--secondary" aria-controls="{{ delete_modal_id }}">
                                                            {{ 'regulation.delete_modal.cancel'|trans }}
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </dialog>
                        </div>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4">
                        <p><em>{{ 'regulation.list.empty'|trans }}</em></p>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
