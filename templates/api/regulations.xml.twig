<?xml version="1.0" encoding="UTF-8"?>

<d2:payload
  modelBaseVersion="3"
  lang="FR"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:d2="http://datex2.eu/schema/3/d2Payload"
  xmlns:com="http://datex2.eu/schema/3/common"
  xmlns:loc="http://datex2.eu/schema/3/locationReferencing"
  xmlns="http://datex2.eu/schema/3/trafficRegulation"
  xsi:schemaLocation="http://datex2.eu/schema/3/d2Payload DATEXII_3_D2Payload.xsd"
  xsi:type="TrafficRegulationPublication"
  id="910928b3-58a1-4462-881b-53dec84602f9"
>
    <com:publicationTime>2022-11-10T15:11:00.000Z</com:publicationTime>
    <com:publicationCreator>
        <com:country>fr</com:country>
        <com:nationalIdentifier>DiaLog</com:nationalIdentifier>
    </com:publicationCreator>

    <trafficRegulationsFromCompetentAuthorities>
    {% for regulationOrder in regulationOrders %}
        {% set startDate = regulationOrder.startDate %}
        {% set endDate = regulationOrder.endDate %}
        {% set location = regulationOrder.location %}
        {% set vehicleCharacteristics = null %}
        <trafficRegulationOrder id="{{ regulationOrder.uuid }}" version="1">
            <description>
                <com:values>
                    <com:value>{{ regulationOrder.description }}</com:value>
                </com:values>
            </description>
            <issuingAuthority>
                <com:values>
                    <com:value>{{ regulationOrder.organization }}</com:value>
                </com:values>
            </issuingAuthority>
            <regulationId>{{ regulationOrder.uuid }}</regulationId>
            <status>madeAndImplemented</status>
            <trafficRegulation>
                <status>active</status>
                <typeOfRegulation xsi:type="AccessRestriction">
                    <accessRestrictionType>noEntry</accessRestrictionType>
                </typeOfRegulation>
                <condition xsi:type="ConditionSet">
                    <operator>and</operator>
                    <conditions xsi:type="ValidityCondition">
                        <negate>false</negate>
                        <validityByOrder>
                            <com:validityStatus>definedByValidityTimeSpec</com:validityStatus>
                            <com:validityTimeSpecification>
                                <com:overallStartTime>{{ startDate|date('Y-m-d') }}T00:00:00.000Z</com:overallStartTime>
                                {% if endDate %}
                                    <com:overallEndTime>{{ endDate|date('Y-m-d') }}T23:59:59.000Z</com:overallEndTime>
                                {% endif %}
                            </com:validityTimeSpecification>
                        </validityByOrder>
                    </conditions>
                    <conditions xsi:type="LocationCondition">
                        <locationByOrder xsi:type="loc:SingleRoadLinearLocation">
                            <loc:secondarySupplementaryDescription>
                                <loc:namedArea>
                                    <loc:areaName>
                                        <com:values>
                                            <com:value>{{ location.postalCode }} {{ location.city }}</com:value>
                                        </com:values>
                                    </loc:areaName>
                                    <loc:namedAreaType>municipality</loc:namedAreaType>
                                    <loc:country>FR</loc:country>
                                </loc:namedArea>
                            </loc:secondarySupplementaryDescription>
                            <loc:linearWithinLinearElement>
                                <loc:directionRelativeOnLinearSection>both</loc:directionRelativeOnLinearSection>
                                <loc:heightGradeOfLinearSection>atGrade</loc:heightGradeOfLinearSection>
                                {% if location.fromHouseNumber or location.toHouseNumber %}
                                    <loc:linearElement xsi:type="loc:LinearElementByPoints">
                                        <loc:roadName>
                                            <com:values>
                                                <com:value>{{ location.roadName }}</com:value>
                                            </com:values>
                                        </loc:roadName>
                                        {% if location.fromHouseNumber %}
                                            <loc:startPointOfLinearElement>
                                                <loc:referentIdentifier>start</loc:referentIdentifier>
                                                <loc:referentName>{{ location.fromHouseNumber }}</loc:referentName>
                                                <loc:referentType>referenceMarker</loc:referentType>
                                                <loc:pointCoordinates>
                                                    <loc:latitude>{{ location.fromLatitude }}</loc:latitude>
                                                    <loc:longitude>{{ location.fromLongitude }}</loc:longitude>
                                                </loc:pointCoordinates>
                                            </loc:startPointOfLinearElement>
                                        {% endif %}
                                        {% if location.toHouseNumber %}
                                            <loc:endPointOfLinearElement>
                                                <loc:referentIdentifier>end</loc:referentIdentifier>
                                                <loc:referentName>{{ location.toHouseNumber }}</loc:referentName>
                                                <loc:referentType>referenceMarker</loc:referentType>
                                                <loc:pointCoordinates>
                                                    <loc:latitude>{{ location.toLatitude }}</loc:latitude>
                                                    <loc:longitude>{{ location.toLongitude }}</loc:longitude>
                                                </loc:pointCoordinates>
                                            </loc:endPointOfLinearElement>
                                        {% endif %}
                                    </loc:linearElement>
                                    <loc:fromPoint xsi:type="loc:PercentageDistanceAlongLinearElement">
                                        <loc:percentageDistanceAlong>0</loc:percentageDistanceAlong>
                                    </loc:fromPoint>
                                    <loc:toPoint xsi:type="loc:PercentageDistanceAlongLinearElement">
                                        <loc:percentageDistanceAlong>100</loc:percentageDistanceAlong>
                                    </loc:toPoint>
                                {% else %}
                                    <loc:linearElement xsi:type="loc:LinearElement">
                                        <loc:roadName>{{ location.roadName }}</loc:roadName>
                                    </loc:linearElement>
                                {% endif %}
                            </loc:linearWithinLinearElement>
                        </locationByOrder>
                    </conditions>
                    {% if vehicleCharacteristics %}
                        <conditions xsi:type="VehicleCondition">
                            <negate>false</negate>
                            <vehicleCharacteristics>
                                {% if vehicleCharacteristics.maxLength %}
                                    <com:lengthCharacteristic>
                                        <com:comparisonOperator>greaterThanOrEqualTo</com:comparisonOperator>
                                        <com:vehicleLength>{{ vehicleCharacteristics.maxLength }}</com:vehicleLength>
                                    </com:lengthCharacteristic>
                                {% endif %}
                                {% if vehicleCharacteristics.maxHeight %}
                                    <com:heightCharacteristic>
                                        <com:comparisonOperator>greaterThanOrEqualTo</com:comparisonOperator>
                                        <com:vehicleHeight>{{ vehicleCharacteristics.maxHeight }}</com:vehicleHeight>
                                    </com:heightCharacteristic>
                                {% endif %}
                                {% if vehicleCharacteristics.maxWidth %}
                                    <com:widthCharacteristic>
                                        <com:comparisonOperator>greaterThanOrEqualTo</com:comparisonOperator>
                                        <com:vehicleWidth>{{ vehicleCharacteristics.maxWidth }}</com:vehicleWidth>
                                    </com:widthCharacteristic>
                                {% endif %}
                                {% if vehicleCharacteristics.maxWeight %}
                                    <com:grossWeightCharacteristic>
                                        <com:comparisonOperator>greaterThanOrEqualTo</com:comparisonOperator>
                                        <com:grossVehicleWeight>{{ vehicleCharacteristics.maxWeight }}</com:grossVehicleWeight>
                                    </com:grossWeightCharacteristic>
                                {% endif %}
                            </vehicleCharacteristics>
                        </conditions>
                    {% endif %}
                </condition>
            </trafficRegulation>
        </trafficRegulationOrder>
    {% endfor %}
    </trafficRegulationsFromCompetentAuthorities>
</d2:payload>
