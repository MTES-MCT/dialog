# 002 - Modèle Conceptuel de Données DiaLog

* Date : 2022-11-09
* Modifié le : 2023-06-13
* Personnes impliquées : Léa Lefoulon, Florimond Manca, Mathieu Marchois
* Statut : Accepté

## Contexte

Dans le cadre du projet DiaLog, nous sommes amenés à numériser les arrêtés de circulation. Nous avons procédé à une [analyse de l'existant](https://github.com/MTES-MCT/dialog/wiki/Analyse-de-l'existant) afin de mieux cerner la problématique métier et les différents acteurs.
Après avoir échangé avec différents calculateurs d'itinéraire comme TomTom, Here (compte rendu disponible [ici](https://pad.incubateur.net/s/uNxJar9q8#2022-10-25---TomTom-amp-Here)), il s'avère que le format qui revient le plus souvent est le [DATEXII](https://www.datex2.eu/) qui est un standard européen qui permet représenter un arrêté de circulation.

## Décision

Nous avons décidé d'orienter notre _modèle conceptuel de données_ (MCD) de telle manière qu'il puisse stocker les différentes informations relative au format DATEXII en plus de ceux qui sont plus spécifiques au fonctionnement de DiaLog comme `User` ou `Organization`.

Le diagramme ci-dessous sera modifié au fur et à mesure de l'évolution du MCD.

```mermaid
classDiagram
direction TB

class User {
    id*: uuid
}

class Organization {
    siret*: char[14]
    name: varchar[255]
}

class RegulationOrderRecord {
    id*: uuid
    regulation_order_uuid: varchar[255]
    created_at: datetime
    status: enum["draft", "published"]
}

class RegulationOrder {
    id*: uuid
    category: varchar[50]
    other_category_text: varchar[100]
    description: text
    issuing_authority: varchar[255]
    start_date?: date
    end_date?: date
}

class Measure {
  id*: uuid
  type: enum["noEntry", "alternateRoad", "oneWayTraffic"]
}

class VehicleCharacteristics {
    id*: uuid
    type: enum["anyVehicle", "lorry"]
    max_weight?: float
    max_height?: float
    max_length?: float
    max_width?: float
    vehicle_usage?: enum["roadMaintenanceOrConstruction"]
    critair?: tinyint
}

class Location {
    id*: uuid
    postal_code: varchar[5]
    city: varchar[255]
    road_name: varchar[255]
    from_house_number: varchar[8]
    from_point: geometry
    to_house_number: varchar[8]
    to_point: geometry
}

class Condition {
    id*: uuid
    negate?: boolean
}

class Period {
    id*: uuid
    applicable_days?: ARRAY[enum["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"]]
    applicable_months?: ARRAY[enum["january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december"]]
    day_start_time?: datetime
    day_end_time?: datetime
    special_days?: ARRAY[enum["publicHoliday", "dayFollowingPublicHoliday", "longWeekendDay", "inLieuOfPublicHoliday", "schoolDay", "schoolHolidays", "publicEventDay", "other"]]
}

User "1..N" -- "1..N" Organization
Organization "0..N" -- "1..1" RegulationOrderRecord
RegulationOrderRecord "0..1" -- "1..1" RegulationOrder
RegulationOrder "1..N" -- "1..1" Location
Location "1..N" -- "1..1" Measure
Measure "0..N" -- "1..1" Condition
Condition "0..1" -- "1..1" VehicleCharacteristics : vehicle_condition
Condition "0..1" -- "1..1" Period : period_condition
```
